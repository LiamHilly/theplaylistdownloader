
<!DOCTYPE html>
<html>
<head>
  <title>SoundCloud Playlist Downloader</title>
</head>
<body>
  <h2>SoundCloud Playlist Downloader</h2>
  <input type="text" id="url" placeholder="Paste SoundCloud playlist URL here" style="width: 400px;">
  <button onclick="startDownload()">Download</button>
  <button onclick="cancelDownload()">Cancel</button>
  <p id="status">Status: Waiting...</p>
  <progress id="progress" value="0" max="100" style="width: 400px;"></progress>
  <h4>Downloaded Tracks:</h4>
  <ul id="trackList"></ul>

  <script>
    let statusInterval;
    let currentCount = 0;

    function updateStatus() {
      fetch('/status')
        .then(response => response.json())
        .then(data => {
          document.getElementById('status').innerText = "Status: " + data.status;

          const trackList = document.getElementById('trackList');
          trackList.innerHTML = '';
          data.tracks.forEach(track => {
            const li = document.createElement('li');
            li.textContent = track;
            trackList.appendChild(li);
          });

          let progress = Math.min(data.tracks.length, 67);
          document.getElementById('progress').value = (progress / 67) * 100;

          if (data.status.includes("Download ready") || data.status.includes("cancelled")) {
            clearInterval(statusInterval);
            if (data.status.includes("ready")) {
              triggerDownload();
            }
          }
        });
    }

    function startDownload() {
      const url = document.getElementById('url').value;
      fetch('/download', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ url })
      }).then(() => {
        document.getElementById('status').innerText = "Status: Starting...";
        document.getElementById('progress').value = 0;
        statusInterval = setInterval(updateStatus, 3000);
      });
    }

    function cancelDownload() {
      fetch('/cancel', { method: 'POST' })
        .then(() => {
          clearInterval(statusInterval);
          document.getElementById('status').innerText = "Status: Cancelled by user.";
        });
    }

    function triggerDownload() {
      const a = document.createElement('a');
      a.href = '/download-file';
      a.download = 'playlist.zip';
      document.body.appendChild(a);
      a.click();
      a.remove();
    }
  </script>
</body>
</html>
